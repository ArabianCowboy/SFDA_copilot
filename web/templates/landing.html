<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta
            name="description"
            content="SFDA Copilot – AI‑powered regulatory guidance for pharmaceutical regulations in Saudi Arabia"
        >
        <title>Welcome to SFDA Copilot</title>

        <!--‑‑ 3rd‑party styles ‑‑-->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            crossorigin="anonymous"
        >
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
            crossorigin="anonymous"
        >

        <!--‑‑ Site CSS ‑‑-->
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/style.css') }}"
        >

        <!--‑‑ Global JS constants injected by Jinja ‑‑-->
        <script>
            window.SUPABASE_URL      = JSON.parse('{{ SUPABASE_URL      | tojson | safe }}');
            window.SUPABASE_ANON_KEY = JSON.parse('{{ SUPABASE_ANON_KEY | tojson | safe }}');
            window.IS_AUTHENTICATED  = JSON.parse('{{ is_authenticated  | tojson | safe }}');
            window.USER_EMAIL        = JSON.parse('{{ user_email        | tojson | safe }}');
        </script>
    </head>

    <body class="d-flex flex-column min-vh-100 landing-page">
        {% if is_authenticated == False %}
        <!-- ‑‑ AUTH MODAL ‑‑ -->
        <div
            class="modal fade"
            id="authModal"
            tabindex="-1"
            aria-labelledby="authModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <!-- Header -->
                    <div class="modal-header text-white">
                        <h2 class="modal-title h5" id="authModalLabel">Login / Signup</h2>
                        <button
                            type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>

                    <!-- Body -->
                    <div class="modal-body p-0">
                        <!-- Tabs -->
                        <ul class="nav nav-tabs nav-fill" id="authTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button
                                    class="nav-link active py-3"
                                    id="login-tab"
                                    data-bs-toggle="tab"
                                    data-bs-target="#login-pane"
                                    type="button"
                                    role="tab"
                                    aria-controls="login-pane"
                                    aria-selected="true"
                                >
                                    <i class="bi bi-box-arrow-in-right me-2"></i>Login
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button
                                    class="nav-link py-3"
                                    id="signup-tab"
                                    data-bs-toggle="tab"
                                    data-bs-target="#signup-pane"
                                    type="button"
                                    role="tab"
                                    aria-controls="signup-pane"
                                    aria-selected="false"
                                >
                                    <i class="bi bi-person-plus me-2"></i>Signup
                                </button>
                            </li>
                        </ul>

                        <!-- Tab panes -->
                        <div class="tab-content p-4" id="authTabContent">
                            <!-- Login pane -->
                            <div
                                class="tab-pane fade show active"
                                id="login-pane"
                                role="tabpanel"
                                aria-labelledby="login-tab"
                            >
                                <form id="login-form" novalidate>
                                    <div class="form-floating mb-3">
                                        <input
                                            type="email"
                                            class="form-control"
                                            id="login-email"
                                            placeholder=" "
                                            required
                                            autocomplete="username"
                                        >
                                        <label for="login-email">
                                            <i class="bi bi-envelope me-2"></i>Email address
                                        </label>
                                        <div class="invalid-feedback">Please provide a valid email.</div>
                                    </div>

                                    <div class="form-floating mb-4">
                                        <input
                                            type="password"
                                            class="form-control"
                                            id="login-password"
                                            placeholder=" "
                                            required
                                            autocomplete="current-password"
                                        >
                                        <label for="login-password">
                                            <i class="bi bi-lock me-2"></i>Password
                                        </label>
                                        <div class="invalid-feedback">Password is required.</div>
                                    </div>

                                    <button
                                        type="submit"
                                        class="btn btn-primary w-100 btn-lg py-2 fw-bold"
                                    >
                                        <span
                                            class="spinner-border spinner-border-sm d-none me-2"
                                            role="status"
                                            aria-hidden="true"
                                        ></span>
                                        Login
                                    </button>
                                </form>
                            </div>

                            <!-- Signup pane -->
                            <div
                                class="tab-pane fade"
                                id="signup-pane"
                                role="tabpanel"
                                aria-labelledby="signup-tab"
                            >
                                <form id="signup-form" novalidate>
                                    <div class="form-floating mb-3">
                                        <input
                                            type="email"
                                            class="form-control"
                                            id="signup-email"
                                            placeholder=" "
                                            required
                                            autocomplete="username"
                                        >
                                        <label for="signup-email">
                                            <i class="bi bi-envelope me-2"></i>Email address
                                        </label>
                                        <div class="invalid-feedback">Please provide a valid email.</div>
                                    </div>

                                    <div class="form-floating mb-4">
                                        <input
                                            type="password"
                                            class="form-control"
                                            id="signup-password"
                                            placeholder=" "
                                            required
                                            pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                                            autocomplete="new-password"
                                        >
                                        <label for="signup-password">
                                            <i class="bi bi-lock me-2"></i>Password
                                        </label>
                                        <div class="form-text mt-1">
                                            Min. 8 chars, 1 uppercase, 1 lowercase, 1 number.
                                        </div>
                                        <div class="invalid-feedback">
                                            Password must meet the requirements.
                                        </div>
                                    </div>

                                    <button
                                        type="submit"
                                        class="btn btn-success w-100 btn-lg py-2 fw-bold"
                                    >
                                        <span
                                            class="spinner-border spinner-border-sm d-none me-2"
                                            role="status"
                                            aria-hidden="true"
                                        ></span>
                                        Signup
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- Error placeholder -->
                        <div
                            id="auth-error"
                            class="alert alert-danger mx-3 mb-3 d-none"
                            role="alert"
                        ></div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ‑‑ MAIN CONTENT ‑‑ -->
        <main class="container-fluid flex-grow-1">
            <div class="row h-100 align-items-center justify-content-center">
                {% if is_authenticated == False %}
                <!-- Unauthenticated -->
                <div id="unauthenticated-view" class="col-md-8 text-center">
                    <div class="landing-hero">
                        <div class="hero-title-wrapper">
                            <i class="bi bi-shield-shaded hero-icon"></i>
                            <h1 class="display-3 fw-bold">SFDA Copilot</h1>
                        </div>
                        <p class="lead mb-4">
                            Your AI‑powered assistant for pharmaceutical regulations in Saudi Arabia
                        </p>
                        <button
                            id="auth-button-main"
                            class="unified-button"
                            type="button"
                            data-bs-toggle="modal"
                            data-bs-target="#authModal"
                        >
                            <i class="bi bi-box-arrow-in-right me-2"></i>Login / Signup
                        </button>
                    </div>
                </div>
                {% endif %}

                {% if is_authenticated == True %}
                <!-- Authenticated gateway -->
                <div id="authenticated-view" class="col-md-8 text-center">
                    <div class="gateway-content">
                        <h1 class="display-4 mb-4">Welcome to SFDA Copilot</h1>
                        <div class="gateway-image mb-4">
                            <i class="bi bi-robot display-1"></i>
                        </div>
                        <p class="lead mb-4">Ready to start your regulatory consultation?</p>
                        <a href="/chat" class="unified-button">
                            <i class="bi bi-chat-dots me-2"></i>Enter Chatbot
                        </a>

                        <div class="mt-3">
                            <span id="user-status-main" class="text-muted">
                                Logged in as: {{ user_email }}
                            </span>
                            <button
                                id="logout-button-main"
                                class="btn btn-outline-danger btn-sm ms-2"
                            >
                                <i class="bi bi-box-arrow-right me-1"></i>Logout
                            </button>
                        </div>

                        <div class="theme-toggle-container mt-3">
                            <button id="theme-toggle-main" class="btn btn-sm btn-secondary" type="button">
                                <i class="bi bi-circle-half me-2"></i>Toggle Theme
                            </button>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </main>

        <!-- Toast -->
        <div
            id="toast"
            class="toast-notification hidden"
            role="alert"
            aria-live="assertive"
        ></div>

        <!-- ‑‑ Scripts ‑‑-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script type="module" src="{{ url_for('static', filename='js/landing.js') }}"></script>
    </body>
</html>
